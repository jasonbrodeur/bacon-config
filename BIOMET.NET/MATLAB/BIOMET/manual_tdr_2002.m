function [tv, tdr] = manual_tdr_2002(siteID,years);

% E. Humphreys Feb 17, 2002
% revisions: Jan 2003
warning off

%siteID = 'CR'
%years = [2001:2002];
%auto = 1;
%auto_set = 1;

%siteID = 'YF'
%years = [2001:2002];
auto = 0;
auto_set = 0;


switch siteID
case 'CR';
   %manual TDR measurements:
   Station	     = [1	1	1     2	2 2	3 3	3	4 4	4	4 4 5	5 5	3 3 3];
   Lprobe        = [20	60	100	20	60	90 20 60 90 20 60 90 20	60 20 60 90 20 60 90];
   ind20_man = find(Lprobe == 20);
   ind60_man = find(Lprobe == 60);
   ind90_man = find(Lprobe >= 90);
   
   ProbeName	={'CR-1-1-20'	'CR-1-1-60'	'CR-1-1-90' 'CR-1-2-20'	'CR-1-2-60'	'CR-1-2-120' ...
         'CR-1-3-20'	'CR-1-3-60'	'CR-1-3-120' 'CR-1-4G-20' 'CR-1-4G-60'	'CR-1-4G-120' ...
         'CR-1-4D-20' 'CR-1-4D-120' 'CR-1-5-20'	'CR-1-5-60'	'CR-1-5-120'	...
         'CR-2-3-20'	'CR-2-3-60'	'CR-2-3-120'};
   
   tv_man = [datenum(2002,5,15) datenum(2002,6,26) datenum(2002,7,12) ....
         datenum(2002,8,15) datenum(2002,8,22) datenum(2002,9,4) ...
         datenum(2002,9, 25) datenum(2002,10, 18) datenum(2002,11,3) datenum(2002,11,30)]';
   
   D1 = 2.22.*ones(1,20);
   
   %D2(1,:) = NaN.*ones(1,20);
   %D2(1,4) = 19.3;
   D2(1,:) = [NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	2.920	4.120	NaN	NaN	NaN		NaN	NaN	NaN];
   D2(2,:) = [NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	2.842	3.892	NaN	NaN	NaN		NaN	NaN	NaN];
   D2(3,:) = [NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	2.936	4.028	NaN	NaN	NaN		NaN	NaN	NaN];
   D2(4,:) = [2.792	3.660	4.764	2.862	3.806	4.478	2.872	3.808	4.746	2.742	3.794	4.674	2.818	3.766	2.816	3.880	4.796		2.866	3.802	4.534];
   D2(5,:) = [2.792	3.636	4.720	2.854	3.758	4.434	2.854	3.772	4.664	2.722	3.746	4.554	2.816	3.740	2.806	3.834	4.710		NaN	NaN	NaN];
   D2(6,:) = [2.792	3.640	4.750	2.862	3.762	4.402	2.870	3.772	4.620	2.752	3.810	4.620	2.852	3.744	2.820	3.820	4.642		NaN	NaN	NaN];
   D2(7,:) = [2.792	3.656	4.726	2.878	3.746	4.426	2.876	3.776	4.596	2.760	3.790	4.626	2.818	3.724	2.844	3.810	4.630		NaN	NaN	NaN];
   D2(8,:) = [NaN	NaN	NaN	2.882	3.768	4.428	2.878	3.790	4.562	2.760	3.810	4.610	2.824	3.740	2.832	3.820	4.626		NaN	NaN	NaN];
   D2(9,:) = [2.812	3.702	4.752	2.902	3.84	4.48	2.896	3.796	4.584	2.814	3.98	4.734	2.884	3.792	2.868	3.904	4.624		NaN	NaN	NaN];
   D2(10,:) = [2.858	3.956	5.306	2.958	4.026	4.846	2.994	4.13	5.27	2.87	4.168	5.3	2.986	4.364	2.946	4.482	5.612		NaN	NaN	NaN];
   
   CF = [0.72	0.93	0.99	0.75	0.92	0.97	0.80	0.95	0.99	0.84	0.89	0.98	0.80	0.95	0.79	0.94	1.01 0.63 0.93 0.87];

   for i = 1:size(D2,1);
      dD(i,:) = CF.*(D2(i,:) - D1).*100;   %m to cm 
   end
   
   dT  = 2.*dD./30;                 %cm to nsec (have to double the distance here!?)
   %LOM = 5.*ones(size(Lprobe));     %cm
   offset = 0;        
   porosity = 0.56;
   
%   LOM = 5.*ones(1,size(dT,2));            %cm
   LOM = [1 1 1 1.5 1.5 1.5 2 2 2 4 4 4 6 6 4 4 4 4 4 4];%determined using 4 soilco2 collar excavations
      
   Theta_v_man = tdr_msmt_conversion(dT,Lprobe,LOM,offset);
   
   %Topp et al version:
   for i = 1:size(dD,1);
      Kb(i,:)  = (dD(i,:)./(0.99.*Lprobe)).^2;
      Theta_v2(i,:) = (Kb(i,:).^0.5 - (2 - porosity))./8; %from WinTDR manual (mixing model)
   end
   
      
   %automated UVic TDR measurements
	   pth  = biomet_path('yyyy','cr','Climate\Clean');
      all_tdr(:,1) = read_bor([pth 'soil_moisture_1_20cm'],[],[],years);
      all_tdr(:,2) = read_bor([pth 'soil_moisture_2_20cm'],[],[],years);
      all_tdr(:,3) = read_bor([pth 'soil_moisture_3_20cm'],[],[],years);
      all_tdr(:,4) = read_bor([pth 'soil_moisture_4_20cm'],[],[],years);
      all_tdr(:,5) = read_bor([pth 'soil_moisture_5_20cm'],[],[],years);
      all_tdr(:,6) = read_bor([pth 'soil_moisture_6_20cm'],[],[],years);
      all_tdr(:,7) = read_bor([pth 'soil_moisture_7_20cm'],[],[],years);
      all_tdr(:,8) = read_bor([pth 'soil_moisture_8_20cm'],[],[],years);
      all_tdr(:,9) = read_bor([pth 'soil_moisture_9_20cm'],[],[],years);
      all_tdr(:,10) = read_bor([pth 'soil_moisture_10_20cm'],[],[],years);
      all_tdr(:,11) = read_bor([pth 'soil_moisture_1_60cm'],[],[],years);
      all_tdr(:,12) = read_bor([pth 'soil_moisture_2_60cm'],[],[],years);
      all_tdr(:,13) = read_bor([pth 'soil_moisture_3_60cm'],[],[],years);
      all_tdr(:,14) = read_bor([pth 'soil_moisture_4_60cm'],[],[],years);
      all_tdr(:,15) = read_bor([pth 'soil_moisture_5_60cm'],[],[],years);
      all_tdr(:,16) = read_bor([pth 'soil_moisture_6_60cm'],[],[],years);
      all_tdr(:,17) = read_bor([pth 'soil_moisture_7_60cm'],[],[],years);
      all_tdr(:,18) = read_bor([pth 'soil_moisture_8_60cm'],[],[],years);
      all_tdr(:,19) = read_bor([pth 'soil_moisture_9_60cm'],[],[],years);
      all_tdr(:,20) = read_bor([pth 'soil_moisture_10_60cm'],[],[],years);
      all_tdr(:,21) = read_bor([pth 'soil_moisture_1_100cm'],[],[],years);
      all_tdr(:,22) = read_bor([pth 'soil_moisture_2_90cm'],[],[],years);
      all_tdr(:,23) = read_bor([pth 'soil_moisture_3_90cm'],[],[],years);
      all_tdr(:,24) = read_bor([pth 'soil_moisture_4_90cm'],[],[],years);
      all_tdr(:,25) = read_bor([pth 'soil_moisture_5_90cm'],[],[],years);
      all_tdr(:,26) = read_bor([pth 'soil_moisture_6_90cm'],[],[],years);
      all_tdr(:,27) = read_bor([pth 'soil_moisture_7_90cm'],[],[],years);
      all_tdr(:,28) = read_bor([pth 'soil_moisture_8_90cm'],[],[],years);
      all_tdr(:,29) = read_bor([pth 'soil_moisture_9_90cm'],[],[],years);
      all_tdr(:,30) = read_bor([pth 'soil_moisture_10_90cm'],[],[],years);
      
      GMT_shift = 8/24;       %shift grenich mean time to 24hr day
     
      tv = read_bor([pth 'clean_tv'],8,[],years)- GMT_shift;
      c  = CR_TDR_init_all;
      Lprobe = c.Lprobe;
      Theta_v = all_tdr;
      
      %include manual measurements from 2002
      for i = 1:length(tv_man);
         ind = find(ceil(tv) == ceil(tv_man(i)) & ~isnan(Theta_v(:,7)));
         if ~isempty(ind);
            Theta_v(ind(1),1:5)= Theta_v_man(i,[1 4 7 10 15]);
            Theta_v(ind(1),11:15)= Theta_v_man(i,[2 5 8 11 16]);
            Theta_v(ind(1),21:25)= Theta_v_man(i,[3 6 9 12 17]);          
         end
      end
         
   
case 'OY'
   
   %manual TDR measurements:
   Station	     = [1	1	2	2	3	3	4	4	5	5	1	1	2	2	3	3	4	4	5	5];
   
   Lprobe = [20 60	20	60	20	60	20	60	20	60	20	60	20	60	20	60	20	60	20	60];
   
   ProbeName	={'OY-1-1-20'	'OY-1-1-60'	'OY-1-2-20'	'OY-1-2-60'	'OY-1-3-20'	'OY-1-3-60'	'OY-1-4-20'...
         'OY-1-4-60'	'OY-1-5-20'	'OY-1-5-60'	'OY-2-1-20'	'OY-2-1-60'	'OY-2-2-20'	'OY-2-2-60'	...
         'OY-2-3-20'	'OY-2-3-60'	'OY-2-4-20'	'OY-2-4-60''OY-2-5-20'	'OY-2-5-60'};
   
   tv = [datenum(2001,8,1) datenum(2001,8,3) datenum(2001,9,4) datenum(2001,9,16) datenum(2001,9,20) ...
         datenum(2001,9,28) datenum(2002,5,16) datenum(2002,6,6) datenum(2002,6,26) datenum(2002,7,12) ....
         datenum(2002,7, 26) datenum(2002,8,8) datenum(2002,8,15) datenum(2002,8,21) datenum(2002,9,5) ...
         datenum(2002,9, 25) datenum(2002,10, 18) datenum(2002,11,3) datenum(2002,12,1)]';
   
   D1 = [17.714	17.843	17.825	17.802	17.832	17.842	17.87	17.851	17.839	17.844	17.84	17.83	17.862	17.862	17.794	17.8	17.872	17.85	17.836	17.818];
   %readjust d1 for newly installed or seemingly -ive theta_v readings
   D1(7)  = 17.84; %was 17.87;
   
   D2(1,:) = [18.4	19.29 18.256 19.264	18.364 19.444 18.354 19.416	18.306 19.4	18.27 19.16 18.272 19.112 18.256 19.436 18.248 19.158 18.258 19.218];
   D2(2,:) = [18.394 19.264 18.3 19.28	18.4 19.46 18.4	19.45 18.322 19.402	18.322 19.242	18.314 19.156 18.27 19.44 18.244 19.154 18.258 19.238];
   D2(3,:) = [18.436 19.334 18.274	19.06 18.384 19.496	18.398 19.446 18.338 19.442	18.312 19.232 18.372 19.248 18.308 19.448 18.286 19.238 18.272 19.302];
   D2(4,:) = [18.416 19.276 18.224	19.274 18.322 19.412 18.362	19.382 18.298 19.368 18.252 19.152 18.288 19.158 18.268 19.338 18.27 19.2 18.252 19.212];
   D2(5,:) = [18.43 19.28 18.232 19.272 18.324	19.384 18.37 19.382	18.342 19.362 18.288 19.252 18.288 19.152 18.248 19.316 18.272 19.212 18.26 19.248];
   D2(6,:) = [18.5	19.41    18.318   19.486	18.478   19.622   18.476   19.556 18.436 19.586 18.508 19.318 18.478 19.318 18.388 19.568 18.308 19.338 18.328 19.438];
   D2(7,:) = [18.428	19.47	   18.234	19.308	18.274	19.618	NaN	19.578	18.350	19.526	18.280	19.230	18.336	19.290	18.354	19.520	18.294	19.370	18.314	19.360];
   D2(8,:) = [18.434	19.456	18.258	19.316	18.282	19.686	NaN	19.546	18.366	19.556	18.358	19.422	18.334	19.272	18.354	19.482	18.314	19.382	18.302	19.312];
   D2(9,:) = [18.400	19.330	18.216	19.226	18.240	19.460	NaN	19.426	18.320	19.456	18.256	19.120	18.244	19.130	18.188	19.200	18.256	19.180	18.224	19.120];
   D2(10,:) =[18.424	19.472	18.264	19.352	18.272	19.660	NaN	19.512	18.348	19.536	18.352	19.526	18.400	19.302	18.304	19.334	18.304	19.324	18.232	19.336];
   D2(11,:) =[18.336	19.238	18.196	19.178	18.288	19.336	18.228	19.332	18.268	19.360	18.236	19.086	18.224	19.106	18.144	19.086	18.232	19.114	18.188	19.100];
   D2(12,:) =[18.284	19.192	18.210	19.140	18.298	19.252	18.254	19.272	18.246	19.284	18.232	19.084	18.236	19.086	18.096	19.036	18.232	19.096	18.188	19.072];
   D2(13,:) =[18.252	19.150	18.180	19.110	18.254	19.186	18.208	19.190	18.210	19.150	18.200	19.042	18.204	19.050	18.016	18.974	18.216	19.050	18.164	19.062];
   D2(14,:) =[18.232	19.114	18.184	19.086	18.252	19.166	18.204	19.170	18.200	19.122	18.206	19.026	18.192	19.026	18.070	18.950	18.204	19.050	18.158	19.046];
   D2(15,:) =[18.224	19.146	18.228	19.106	18.296	19.206	18.244	19.196	18.236	19.126	18.238	19.090	18.238	19.070	18.078	18.970	18.238	19.070	18.178	19.080];
   D2(16,:) =[18.224	19.096	18.216	19.136	18.308	19.228	18.248	19.224	18.232	19.124	18.248	19.148	18.252	19.088	18.088	18.982	18.252	19.074	18.188	19.174];
   D2(17,:) =[18.24	19.196	18.24	   19.166	18.36	   19.316	18.276	19.28	   18.284	19.162	18.288	19.204	18.32	      19.136	18.112	19.026	18.284	19.116	18.196	19.246];
   D2(18,:) =[18.288	19.202	18.308	19.302	18.36	   19.392	18.348	19.408	18.364	19.252	18.364	19.304	18.464	19.194	18.14	      19.054	18.324	19.134	18.24	      19.344];
   D2(19,:) =[18.472	19.504	18.34	   19.424	18.372	19.634	18.436	19.644	18.388	19.534	18.41	      19.472	18.516	19.402	18.286	19.322	18.366	19.372	18.326	19.462];
   
   for i = 1:size(D2,1);
      dD(i,:) = (D2(i,:) - D1).*100;   %m to cm 
   end
   
   dT  = 2.*dD./30;                 %cm to nsec (have to double the distance here!?)
   %LOM = 5.*ones(size(Lprobe));     %cm
   LOM = [6 6 1 1 0.5 0.5 2.5 2.5 1.5 1.5 3 3 2 2 20 20 2 2 1 1];
   
   offset = 0;
   
   porosity = 0.58; %0.5;
   
   
case 'YF'
   %manual TDR measurements:
   Station	     = [1	1	2	2	3	3	4	4	5	5	1	1	2	2	3	3	4	4	5	5];
   
   Lprobe = [20 60	20	60	20	60	20	60	20	60	20	60	20	60	20	60	20	60	20	60];
   
   ProbeName	={'YF-1-1-20'	'YF-1-1-60'	'YF-1-2-20'	'YF-1-2-60'	'YF-1-3-20'	'YF-1-3-60'	....
         'YF-1-4-20'	'YF-1-4-60'	'YF-1-5-20'	'YF-1-5-60'	'YF-2-1-20'	'YF-2-1-60'	'YF-2-2-20'	....
         'YF-2-2-60'	'YF-2-3-20'	'YF-2-3-60'	'YF-2-4-20'	'YF-2-4-60''YF-2-5-20'	'YF-2-5-60'};
   
   tv = [datenum(2002,7,11) datenum(2002,7, 25) datenum(2002,8,9) datenum(2002,8,16) datenum(2002,8,23) ...
         datenum(2002,9,5) datenum(2002,9, 26) datenum(2002,10, 19) datenum(2002,11,4)]';
   
   D1 = [17.936	17.944	17.932	17.966	17.950	17.982	17.924	17.912	17.914	17.998	...
         17.936	17.952	17.956	17.940	17.918	17.924	17.898	17.920	17.916	17.924];
   
   %D2(1,:) = NaN.*ones(1,20);
   %D2(1,4) = 19.3;
   D2(1,:) = [18.756	20.712	18.440	19.800	18.658	20.070	18.546	19.742	18.402	19.826	18.720	20.414	18.412	19.656	18.514	19.638	18.598	20.440	18.402	19.676];
   D2(2,:) = [18.616	20.498	18.308	19.538	18.512	19.848	18.464	19.458	18.344	19.650	18.608	20.224	18.368	19.474	18.404	19.406	18.468	20.166	18.332	19.532];
   D2(3,:) = [18.560	20.352	18.320	19.432	18.480	19.732	18.460	19.432	18.356	19.582	18.571	20.162	18.392	19.482	18.364	19.362	18.448	19.992	18.352	19.492];
   D2(4,:) = [18.492	20.172	18.252	19.352	18.448	19.562	18.428	19.342	18.328	19.512	18.484	19.972	18.360	19.382	18.332	19.212	18.408	19.822	18.312	19.362];
   D2(5,:) = [18.454	20.068	18.242	19.288	18.43	19.478	18.426	19.328	18.314	19.488	18.44	19.85	18.356	19.36	18.324	19.156	18.396	19.716	18.3	19.304];
   D2(6,:) = [18.440	19.974	18.260	19.264	18.432	19.434	18.432	19.314	18.324	19.474	18.428	19.724	18.360	19.364	18.332	NaN	18.384	19.624	18.304	19.274];
   D2(7,:) = [18.44	19.952	18.258	19.242	18.436	19.426	18.42	19.314	18.312	19.474	18.428	19.672	18.368	19.362	18.328	19.082	18.396	19.602	18.312	19.294];
   D2(8,:) = [18.476	20.044	18.32	19.264	18.456	19.472	18.464	19.372	18.36	19.504	18.472	19.788	18.388	19.398	18.348	19.156	18.42	19.65	18.332	19.318];
   D2(9,:) = [18.476	20.032	NaN	19.272	18.468	19.472	18.452	19.362	18.352	19.512	18.464	19.742	18.38	19.398	18.36	19.136	18.424	19.648	18.332	19.318];
   
   for i = 1:size(D2,1);
      dD(i,:) = (D2(i,:) - D1).*100;   %m to cm 
   end
   
   dT  = 2.*dD./30;                 %cm to nsec (have to double the distance here!?)
%   LOM = 5.*ones(size(Lprobe));     %cm
   LOM = [1 1 5 5 1 1 2 2 2 2 2 2 2 2 6 6 5 5 6 6]; %determined using 4 soilco2 collar excavations
   offset = 0;
   
   porosity = 0.64;
 
end

%----------------------------------------------------------
%calculate volumetric water content:
if siteID ~= 'CR'
   Theta_v = tdr_msmt_conversion(dT,Lprobe,LOM,offset);
   Theta_v = Theta_v;                     %in fraction
   
   %Topp et al version:
   for i = 1:size(dD,1);
      Kb(i,:)  = (dD(i,:)./(0.99.*Lprobe)).^2;
      Theta_v2(i,:) = (Kb(i,:).^0.5 - (2 - porosity))./8; %from WinTDR manual (mixing model)
   end
end


%----------------------------------------------------------
keep    = find(tv >= datenum(years,1,1) & tv < datenum(years+1,1,1));
Theta_v = Theta_v(keep,:);
tv      = tv(keep);

ind20 = find(Lprobe == 20);
ind60 = find(Lprobe == 60);
ind90 = find(Lprobe >= 90);

tdr.a = Theta_v(:,ind20);
tdr.b = Theta_v(:,ind60);
tdr.c = Theta_v(:,ind90);
