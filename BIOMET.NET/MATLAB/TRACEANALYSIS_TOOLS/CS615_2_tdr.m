function[corr_30, corr_100, CS615_30, CS615_100] = CS615_2_tdr(tv,CS615);

%
%
%
% E. Humphreys  25.03.01

coeff_100_2 = [0.2789    5.7876    0.0989];
coeff_100_1 = [0.3017    3.7009    0.0993];
p_100       = [1.3395    0.0491];
   
coeff_30_1  = [0.2696    6.3342    0.0834];%[0.2876    6.6722    0.0815];
coeff_30_2  = [0.2339    8.7584    0.0943];%[0.2633    8.2464    0.0942];
p_30        = [1.6180   -0.0077];%[1.4928    0.0361];

CS615_100  = CS615(:,1).*(0.05-0) + CS615(:,2).*(.25-0.05) + ...
   CS615(:,3).*(0.6-0.25) + CS615(:,4).*(1-0.6);
CS615_30   = CS615(:,2).*0.8 + CS615(:,1).*0.2;
%CS615_30   = CS615(:,2).*0.8 + CS615(:,1).*0.1 + CS615(:,3).*0.1;
%CS615_30   = CS615(:,2).*0.9 + CS615(:,1).*0.1;

corr_30      = NaN.*ones(length(tv),1);
corr_100     = NaN.*ones(length(tv),1);

ind          = find(CS615_30 <=0.15 & tv < datenum(1999,1,1));
corr_30(ind) = coeff_30_1(1).*...
   (CS615_30(ind).^coeff_30_1(2)./(coeff_30_1(3).^coeff_30_1(2) + CS615_30(ind).^coeff_30_1(2)));
ind          = find(CS615_100 <=0.15 & tv < datenum(1999,1,1));
corr_100(ind)= coeff_100_1(1).*...
   (CS615_100(ind).^coeff_100_1(2)./(coeff_100_1(3).^coeff_100_1(2) + CS615_100(ind).^coeff_100_1(2)));

ind          = find(CS615_30 <=0.15 & tv >= datenum(1999,1,1));
corr_30(ind) = coeff_30_2(1).*...
   (CS615_30(ind).^coeff_30_2(2)./(coeff_30_2(3).^coeff_30_2(2) + CS615_30(ind).^coeff_30_2(2)));
ind          = find(CS615_100 <=0.15 & tv >= datenum(1999,1,1));
corr_100(ind)= coeff_100_2(1).*...
   (CS615_100(ind).^coeff_100_2(2)./(coeff_100_2(3).^coeff_100_2(2) + CS615_100(ind).^coeff_100_2(2)));

ind          = find(CS615_30 >0.15);
corr_30(ind) = polyval(p_30,CS615_30(ind));
ind          = find(CS615_100 >0.15);
corr_100(ind)= polyval(p_100,CS615_100(ind));


%corr_30      = corr_30+0.01;