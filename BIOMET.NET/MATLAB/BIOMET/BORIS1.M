%******************************************************************************
%
% this scrip will create a data file for BORIS
%
% Written by Zoran Nesic, July 12, 1995
%******************************************************************************
dirs = str2mat( 'd:\cd-rom\data\mfubc',...
                'd:\cd-rom\data\trubc',...
                'd:\cd-rom\data\snubc',...
                'd:\cd-rom\data\hfubc',...
                'd:\cd-rom\data\soubc',...                
                'd:\cd-rom\data\soubc'...
                 );

dirSpan = [ 9 15 22 35 51 54 ];

fileNames = str2mat(    'mfubc.7',...
                        'mfubc.8',...
                        'mfubc.9',...
                        'mfubc.10',...
                        'mfubc.6',...
                        'mfubc.11',...
                        'mfubc.12',...
                        'mfubc.14',...
                        'mfubc.15'...
                        );
fileNames = str2mat(   fileNames,...                         
                        'trubc_7',...  
                        'trubc_8',...  
                        'trubc_9',...  
                        'trubc_10',...  
                        'trubc_11',...  
                        'trubc_12'...  
                        );
fileNames = str2mat(   fileNames,...                                                 
                        'snubc_8',...  
                        'snubc_11',...  
                        'snubc_12',...  
                        'snubc_13',...  
                        'snubc_14',...  
                        'snubc_15',...  
                        'snubc_16'...  
                        );
fileNames = str2mat(   fileNames,...                                                 
                        'hfubc_5.2_2',...  
                        'hfubc_7.2_2',...  
                        'hfubc_8.2_2',...
                        'hfubc_10.1_2',...
                        'hfubc_9.1_2',...
                        'hfubc_12.1_2',...
                        'hfubc_27.1_2',...
                        'hfubc_87.2_2',...
                        'hfubc_44.1_2'...
                        );
fileNames = str2mat(   fileNames,...                                                 
                        'hfubc_81.2_2',...
                        'hfubc_82.2_2',...
                        'hfubc_84.2_2',...
                        'hfubc_46.2_2'...                        
                        );
fileNames = str2mat(    fileNames,...                                                 
                        'soil1.9',...
                        'soil1.10',...
                        'soil1.11',...
                        'soil1.12',...
                        'soil1.13',...
                        'soil1.14',...
                        'soil1.17',...
                        'soil1.18',...
                        'soil1.19'...                                  
                        );           
fileNames = str2mat(    fileNames,...                                                 
                        'soil1.20',...
                        'soil1.21',...
                        'soil1.22',...
                        'soil1.23',...
                        'soil1.24',...
                        'soil1.25',...
                        'soil1.26'...
                        );
fileNames = str2mat(    fileNames,...
                        'soil2.6',...
                        'soil2.7',...
                        'soil2.9'...
                        );
                        
flagFiles = str2mat(    'mfubc_f1',...
                        'trubc_f1',...
                        'snubc_f1',...
                        'hfubc_f1',...
                        'soil1_f1',...
                        'soil2_f1'...
                        );
flagSize = [ 2  7  7  11  8 2];                   

M = length(fileNames);
tmp = read_bor( [ deblank( dirs(1,:) )  '\' deblank(fileNames(1,:)) ] );
N = length(tmp);
clear tmp 
output1 = zeros(N,M);                        
dateStr = read_bor( 'd:\cd-rom\data\hfubc\hfubc_d', 4 );
StartTime = read_bor( 'd:\cd-rom\data\start_t', 6 );
StopTime = read_bor( 'd:\cd-rom\data\stop_t', 6 );
timeDec = read_bor( 'd:\cd-rom\data\hfubc\hfubc_dt', 1 );
k = 1
flags = read_bor( [ deblank( dirs(k,:) )  '\' deblank(flagFiles(k,:)) ],2, flagSize(k) );
flagInd = find( flags(:,1) == 0 );
a9999 = 9999*ones(size(flagInd));
for i = 1: M
    if i > dirSpan(k)
        k = k + 1;
        flags = read_bor( [ deblank( dirs(k,:) )  '\' deblank(flagFiles(k,:)) ],2, flagSize(k) );
        flagInd = find( flags(:,1) == 0 );
        a9999 = 9999*ones(size(flagInd));
    end
    [i k]
    output1(:,i) = read_bor( [ deblank( dirs(k,:) )  '\' deblank(fileNames(i,:)) ] );
    output1(flagInd,i) = a9999;             % missing data
end
%
% load soil heat data
%
load d:\cd-rom\data.raw\mat\shubc
%
% replace NaN's with 9999's
ind = find( isnan(shubc) == 1 );
shubc(ind) = 9999*ones(size(ind));


%==============================================================================                  
% print 1994 year only
%

offset = 153*48+2;
endOffset = N;
formatX = '%s %4d %5d %5d'; 
for i = 1:M+5
    formatX = [formatX ' %8.4e'];
end
formatX = [formatX '\x00d\n'];

dateStr1 = dateStr(:,[9:10 1:2 4:5]);
k = 1
fid = fopen('out1','w');
CurrDate = '01';
for row=offset:N
    if ~strcmp(CurrDate,dateStr1(row-1,3:4))
        k = k + 1
        fclose(fid);
        eval(['fid =fopen(''' 'out' num2str(k) ''',''' 'w' ''');']); 
        CurrDate = dateStr1(row-1,3:4);
    end
    fprintf(fid,formatX,dateStr1(row-1,:),fix(timeDec(row-1)-152),StartTime(row,:),StopTime(row,:),[output1(row,:) shubc(row,2:6)] );
end
fclose(fid);
                                                                 
